<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartografía del Streaming en Argentina</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            display: block;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .search-box, .filter-select {
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .search-box:focus, .filter-select:focus {
            outline: none;
            border-color: #3498db;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #e0e6ed;
            vertical-align: top;
        }

        tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .channel-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .subscribers {
            font-weight: bold;
            color: #e74c3c;
        }

        .expand-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8em;
            transition: background-color 0.3s ease;
        }

        .expand-btn:hover {
            background: #2980b9;
        }

        .description-row {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
        }

        .description-content {
            padding: 15px;
            font-style: italic;
            color: #2c3e50;
            line-height: 1.4;
        }

        .method-tag {
            background: #9b59b6;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .url-link {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .url-link:hover {
            text-decoration: underline;
        }

        .charts-grid {
            display: none;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .pagination button {
            padding: 10px 15px;
            border: none;
            background: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #2980b9;
        }

        .pagination button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .pagination button.active {
            background: #2c3e50;
        }

        .methodology-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .methodology-content {
            background: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .close-methodology {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
            background: none;
            border: none;
        }

        .close-methodology:hover {
            color: #000;
        }

        .methodology-section {
            margin-bottom: 25px;
        }

        .methodology-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3em;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        .methodology-section p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 10px;
        }

        .process-step {
            background: #f8f9fa;
            border-left: 4px solid #27ae60;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .tech-item {
            background: #ecf0f1;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }

        .automation-flow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .flow-step .step-number {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box, .filter-select {
                min-width: auto;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9em;
            }
            
            th, td {
                padding: 8px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🇦🇷 Cartografía del Streaming en Argentina</h1>
            <p class="subtitle">Estudio Académico - Análisis de Canales de YouTube con Transmisiones en Vivo</p>
            <div id="lastUpdate" style="color: #7f8c8d; font-size: 0.9em; margin-top: 10px;"></div>
            <button id="methodologyBtn" style="background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 15px; font-size: 0.9em;">
                📊 Ver Metodología
            </button>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <span id="totalChannels" class="stat-number">0</span>
                <span class="stat-label">Canales de Streaming</span>
            </div>
            <div class="stat-card">
                <span id="totalSubscribers" class="stat-number">0</span>
                <span class="stat-label">Suscriptores Totales</span>
            </div>
            <div class="stat-card">
                <span id="avgCerteza" class="stat-number">0%</span>
                <span class="stat-label">Certeza Promedio</span>
            </div>
            <div class="stat-card">
                <span id="totalProvinces" class="stat-number">0</span>
                <span class="stat-label">Provincias Cubiertas</span>
            </div>
        </div>

        <div class="controls">
            <input type="text" id="searchInput" class="search-box" placeholder="🔍 Buscar por nombre de canal, descripción o ubicación...">
            <select id="provinceFilter" class="filter-select">
                <option value="">Todas las provincias</option>
            </select>
            <select id="cityFilter" class="filter-select">
                <option value="">Todas las ciudades</option>
            </select>
        </div>

        <div class="table-container">
            <table id="channelsTable">
                <thead>
                    <tr>
                        <th>Canal</th>
                        <th>Ubicación</th>
                        <th>Suscriptores</th>
                        <th>Certeza</th>
                        <th>Método Detección</th>
                        <th>Ver Descripción</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <div class="pagination" id="pagination"></div>

        <!-- Modal de Metodología -->
        <div id="methodologyModal" class="methodology-modal">
            <div class="methodology-content">
                <button class="close-methodology" onclick="closeMethodology()">&times;</button>
                
                <h2 style="color: #2c3e50; text-align: center; margin-bottom: 30px;">
                    🔬 Metodología de Investigación
                </h2>

                <div class="methodology-section">
                    <h3>🎯 Objetivo del Estudio</h3>
                    <p>Este proyecto busca crear una cartografía completa del ecosistema de streaming en Argentina, identificando y analizando canales de YouTube que realizan transmisiones en vivo, con el objetivo de comprender la distribución geográfica y las características de este fenómeno digital en el país.</p>
                </div>

                <div class="methodology-section">
                    <h3>🤖 Sistema de Detección Automatizado</h3>
                    <p>Desarrollamos un sistema automatizado en Python que utiliza la API de YouTube Data v3 para identificar canales argentinos con capacidad de streaming. El sistema emplea múltiples algoritmos de detección:</p>
                    
                    <div class="process-step">
                        <strong>Detección Explícita:</strong> Análisis de metadatos del canal, descripciones y ubicación declarada que mencionen explícitamente "Argentina".
                    </div>
                    
                    <div class="process-step">
                        <strong>Detección por Provincia:</strong> Identificación de menciones específicas de provincias argentinas en descripciones y contenido.
                    </div>
                    
                    <div class="process-step">
                        <strong>Análisis de Contenido:</strong> Procesamiento de títulos de videos, descripciones y metadata para identificar indicadores culturales y lingüísticos argentinos.
                    </div>
                    
                    <div class="process-step">
                        <strong>Verificación de Streaming:</strong> Detección automática de canales con capacidad de transmisión en vivo activa.
                    </div>
                </div>

                <div class="methodology-section">
                    <h3>⚙️ Stack Tecnológico</h3>
                    <div class="tech-stack">
                        <div class="tech-item">🐍 Python 3.x</div>
                        <div class="tech-item">📺 YouTube Data API v3</div>
                        <div class="tech-item">🐙 GitHub Actions</div>
                        <div class="tech-item">🌐 Netlify</div>
                        <div class="tech-item">📊 Chart.js</div>
                        <div class="tech-item">💾 CSV Database</div>
                    </div>
                </div>

                <div class="methodology-section">
                    <h3>🔄 Automatización Diaria</h3>
                    <p>El sistema funciona de manera completamente automatizada utilizando GitHub Actions:</p>
                    
                    <div class="automation-flow">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div>Cada día a las 00:00 UTC se ejecuta automáticamente el script de Python</div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div>El script consulta la API de YouTube buscando nuevos canales argentinos</div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div>Se aplican los algoritmos de detección y verificación de argentinidad</div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">4</div>
                            <div>Los datos se procesan y actualizan en el archivo CSV</div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">5</div>
                            <div>GitHub Actions hace commit automático de los cambios</div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">6</div>
                            <div>Netlify detecta los cambios y redeploya automáticamente esta visualización</div>
                        </div>
                    </div>
                </div>

                <div class="methodology-section">
                    <h3>📊 Métricas de Confianza</h3>
                    <p>Cada canal detectado recibe un <strong>índice de certeza</strong> basado en:</p>
                    <ul style="color: #555; line-height: 1.6;">
                        <li><strong>100%:</strong> Mención explícita de Argentina en metadatos oficiales</li>
                        <li><strong>90-99%:</strong> Múltiples indicadores convergentes (provincia + contenido + idioma)</li>
                        <li><strong>70-89%:</strong> Indicadores provinciales y culturales consistentes</li>
                        <li><strong>50-69%:</strong> Indicadores lingüísticos y geográficos parciales</li>
                    </ul>
                </div>

                <div class="methodology-section">
                    <h3>🔍 Datos Recopilados</h3>
                    <p>Para cada canal identificado, el sistema recopila y actualiza diariamente:</p>
                    <ul style="color: #555; line-height: 1.6;">
                        <li>Información básica del canal (nombre, URL, descripción)</li>
                        <li>Ubicación geográfica (provincia y ciudad cuando está disponible)</li>
                        <li>Métricas de audiencia (número de suscriptores)</li>
                        <li>Capacidades técnicas (streaming en vivo activo/inactivo)</li>
                        <li>Indicadores de argentinidad y método de detección utilizado</li>
                        <li>Timestamp de detección y última verificación</li>
                    </ul>
                </div>

                <div class="methodology-section">
                    <h3>🏛️ Impacto Académico</h3>
                    <p>Esta investigación contribuye al entendimiento del ecosistema digital argentino, proporcionando datos cuantitativos sobre la distribución geográfica del streaming, patrones de adopción tecnológica y la democratización de la producción de contenido audiovisual en Argentina.</p>
                </div>

                <div class="methodology-section">
                    <h3>🔗 Reproducibilidad</h3>
                    <p>Todos los datos y metodologías están documentados y son reproducibles. El código fuente, los datos procesados y esta visualización se actualizan automáticamente, garantizando transparencia y verificabilidad de los resultados.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos de ejemplo basados en tu estructura
        let channelsData = [
            {
                nombre_canal: "La 100",
                provincia: "Santa Fe",
                ciudad: "Por determinar",
                suscriptores: 562000,
                certeza: 100,
                metodo_deteccion: "explicit_country",
                indicadores_argentinidad: "menciona_argentina",
                url: "https://youtube.com/channel/UC2zO2jZCDplwm8SVsXUcxCQ",
                fecha_deteccion: "2025-06-18",
                descripcion: "¡Bienvenidos al canal oficial de La100.com.ar en Youtube! Suscribite y mirá contenidos exclusivos cuando y donde quieras de El Club del Moro, No Esta Todo Dicho, Sarasa, Atardecer de un Día Agitado, las secciones de Guillermo Coppola, Costa, la contadora, En Tercera Persona con Guido Kaczka y Gunda Fontán, Entrevistas de Bebe Sanzo, novedades de cine y series, y la mejor selección de videos de géneros pensados para vos. Sumate y se parte de la comunidad de La 100 en Youtube. ¡Bienvenidos!",
                pais_detectado: "Argentina",
                videos_analizados: 5
            },
            {
                nombre_canal: "Gran Hermano Argentina",
                provincia: "Argentina",
                ciudad: "Por determinar",
                suscriptores: 1570000,
                certeza: 95,
                metodo_deteccion: "explicit_country",
                indicadores_argentinidad: "menciona_argentina",
                url: "https://youtube.com/channel/UCFAiSCNaJnizLNIF1aSkQAQ",
                fecha_deteccion: "2025-06-18",
                descripcion: "¡Enterate de todo lo que pasa en la casa más famosa del país! 👁‍🗨 Mirá los programas acá 👇 👉 https://granhermano.mitelefe.com/",
                pais_detectado: "Argentina",
                videos_analizados: 5
            },
            {
                nombre_canal: "Radio Con Vos 89.9",
                provincia: "Buenos Aires",
                ciudad: "Por determinar",
                suscriptores: 277000,
                certeza: 88,
                metodo_deteccion: "province_mention",
                indicadores_argentinidad: "provincia_Buenos Aires",
                url: "https://youtube.com/channel/UCxDteokWBemJvLI_I0VUGdA",
                fecha_deteccion: "2025-06-18",
                descripcion: "Periodismo de tu lado. FM 89.9 · Escribinos tu mensaje Wtspp 15-5379-8990 Twitter, Instagram, Facebook: @radioconvos899 📣 Ya te podes unir al canal oficial en telegram de #Radioconvos y ver contenidos exclusivos de la radio.➡ https://t.me/Radioconvos899",
                pais_detectado: "Argentina",
                videos_analizados: 5
            },
            {
                nombre_canal: "Radio La Red AM 910",
                provincia: "Argentina",
                ciudad: "Por determinar",
                suscriptores: 264000,
                certeza: 95,
                metodo_deteccion: "explicit_country",
                indicadores_argentinidad: "menciona_argentina",
                url: "https://youtube.com/channel/UCs1U5lRXvUJHn0CgXI6oXAw",
                fecha_deteccion: "2025-06-18",
                descripcion: "🟦 ¿Querés ver más videos como este? ¡Suscribite a nuestro canal! → https://bit.ly/3CpUf8m ⬜ Encontrá más noticias y sintonizá la programación en nuestra web → https://www.lared.am/ 🟦 También nos podés escuchar en: 📻 AM 910 📱 APP: La Red - AM 910 (Android - iOS)",
                pais_detectado: "Argentina",
                videos_analizados: 5
            }
        ];

        let filteredData = [...channelsData];
        let currentPage = 1;
        const itemsPerPage = 20;

        // Inicializar la aplicación
        function init() {
            updateStats();
            populateFilters();
            setupEventListeners();
            renderTable();
            updateLastUpdate();
        }

        function updateStats() {
            const total = channelsData.length;
            const totalSubs = channelsData.reduce((sum, ch) => sum + (ch.suscriptores || 0), 0);
            const avgCerteza = channelsData.length > 0 ? 
                channelsData.reduce((sum, ch) => sum + (ch.certeza || 0), 0) / total : 0;
            const provinces = new Set(channelsData.map(ch => ch.provincia).filter(p => p && p !== '')).size;
            const streaming = channelsData.filter(ch => ch.tiene_streaming === true).length;

            document.getElementById('totalChannels').textContent = total.toLocaleString();
            document.getElementById('totalSubscribers').textContent = 
                totalSubs > 1000000 ? (totalSubs / 1000000).toFixed(1) + 'M' :
                totalSubs > 1000 ? (totalSubs / 1000).toFixed(0) + 'K' : 
                totalSubs.toLocaleString();
            document.getElementById('avgCerteza').textContent = avgCerteza.toFixed(1) + '%';
            document.getElementById('totalProvinces').textContent = provinces;
        }

        function populateFilters() {
            const provinces = [...new Set(channelsData.map(ch => ch.provincia).filter(p => p && p !== ''))].sort();
            const cities = [...new Set(channelsData.map(ch => ch.ciudad).filter(c => c && c !== '' && c !== 'Por determinar'))].sort();

            const provinceSelect = document.getElementById('provinceFilter');
            const citySelect = document.getElementById('cityFilter');

            // Limpiar opciones existentes (excepto la primera)
            provinceSelect.innerHTML = '<option value="">Todas las provincias</option>';
            citySelect.innerHTML = '<option value="">Todas las ciudades</option>';

            provinces.forEach(prov => {
                const option = document.createElement('option');
                option.value = prov;
                option.textContent = prov;
                provinceSelect.appendChild(option);
            });

            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                citySelect.appendChild(option);
            });
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterData);
            document.getElementById('provinceFilter').addEventListener('change', filterData);
            document.getElementById('cityFilter').addEventListener('change', filterData);
            document.getElementById('methodologyBtn').addEventListener('click', openMethodology);
        }

        function openMethodology() {
            document.getElementById('methodologyModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeMethodology() {
            document.getElementById('methodologyModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Cerrar modal al hacer clic fuera de él
        window.onclick = function(event) {
            const modal = document.getElementById('methodologyModal');
            if (event.target === modal) {
                closeMethodology();
            }
        }

        function filterData() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const province = document.getElementById('provinceFilter').value;
            const city = document.getElementById('cityFilter').value;

            filteredData = channelsData.filter(channel => {
                const matchesSearch = !search || 
                    channel.nombre_canal.toLowerCase().includes(search) ||
                    channel.descripcion.toLowerCase().includes(search) ||
                    channel.provincia.toLowerCase().includes(search) ||
                    channel.ciudad.toLowerCase().includes(search);
                
                const matchesProvince = !province || channel.provincia === province;
                const matchesCity = !city || channel.ciudad === city;

                return matchesSearch && matchesProvince && matchesCity;
            });

            currentPage = 1;
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            tbody.innerHTML = '';

            pageData.forEach((channel, index) => {
                const rowId = `row-${startIndex + index}`;
                const descId = `desc-${startIndex + index}`;
                
                const row = document.createElement('tr');
                row.id = rowId;
                row.innerHTML = `
                    <td>
                        <div class="channel-name">
                            <a href="${channel.url}" target="_blank" class="url-link">${channel.nombre_canal}</a>
                        </div>
                        <small style="color: #7f8c8d;">
                            ${channel.categoria || 'Sin categoría'} • 
                            Videos analizados: ${channel.videos_analizados || 0}
                        </small>
                    </td>
                    <td>
                        <strong>${channel.provincia}</strong><br>
                        <small>${channel.ciudad || 'Ciudad no especificada'}</small>
                    </td>
                    <td class="subscribers">${(channel.suscriptores || 0).toLocaleString()}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 40px; height: 6px; background: #e0e6ed; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.min(100, channel.certeza || 0)}%; height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71);"></div>
                            </div>
                            <span style="font-size: 0.9em; font-weight: bold;">${(channel.certeza || 0).toFixed(1)}%</span>
                        </div>
                    </td>
                    <td>
                        <span class="method-tag">${(channel.metodo_deteccion || 'unknown').replace(/_/g, ' ')}</span>
                    </td>
                    <td>
                        <button class="expand-btn" onclick="toggleDescription('${descId}', '${rowId}')">
                            📄 Ver Descripción
                        </button>
                    </td>
                `;
                tbody.appendChild(row);

                // Crear fila para descripción (inicialmente oculta)
                const descRow = document.createElement('tr');
                descRow.id = descId;
                descRow.className = 'description-row';
                descRow.style.display = 'none';
                descRow.innerHTML = `
                    <td colspan="6">
                        <div class="description-content">
                            <strong>📺 Descripción del canal:</strong><br>
                            ${channel.descripcion || 'Sin descripción disponible'}<br><br>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                                <div>
                                    <strong>🇦🇷 Indicadores de argentinidad:</strong><br>
                                    ${channel.indicadores_argentinidad || 'No especificado'}
                                </div>
                                <div>
                                    <strong>🌍 País detectado:</strong><br>
                                    ${channel.pais_detectado || 'No especificado'}
                                </div>
                                <div>
                                    <strong>📅 Fecha de detección:</strong><br>
                                    ${channel.fecha_deteccion ? new Date(channel.fecha_deteccion).toLocaleDateString('es-AR') : 'No especificada'}
                                </div>
                                <div>
                                    <strong>🔴 Streaming:</strong><br>
                                    ${channel.tiene_streaming ? '✅ Activo' : '❌ Inactivo'}
                                </div>
                            </div>
                            
                            ${channel.ultima_actividad ? `<br><strong>⏰ Última actividad:</strong> ${new Date(channel.ultima_actividad).toLocaleDateString('es-AR')}` : ''}
                        </div>
                    </td>
                `;
                tbody.appendChild(descRow);
            });

            renderPagination();
        }

        function toggleDescription(descId, rowId) {
            const descRow = document.getElementById(descId);
            const button = document.querySelector(`#${rowId} .expand-btn`);
            
            if (descRow.style.display === 'none') {
                descRow.style.display = 'table-row';
                button.textContent = '📄 Ocultar Descripción';
            } else {
                descRow.style.display = 'none';
                button.textContent = '📄 Ver Descripción';
            }
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            const paginationDiv = document.getElementById('pagination');
            
            paginationDiv.innerHTML = '';

            if (totalPages <= 1) return;

            // Botón anterior
            const prevBtn = document.createElement('button');
            prevBtn.textContent = '← Anterior';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => { currentPage--; renderTable(); };
            paginationDiv.appendChild(prevBtn);

            // Números de página
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = i === currentPage ? 'active' : '';
                btn.onclick = () => { currentPage = i; renderTable(); };
                paginationDiv.appendChild(btn);
            }

            // Botón siguiente
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Siguiente →';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => { currentPage++; renderTable(); };
            paginationDiv.appendChild(nextBtn);
        }

        function renderCharts() {
            renderProvinceChart();
            renderSubscribersChart();
        }

        function renderSubscribersChart() {
            // Crear rangos de suscriptores
            const ranges = {
                '0-10K': 0,
                '10K-100K': 0,
                '100K-500K': 0,
                '500K-1M': 0,
                '1M+': 0
            };

            channelsData.forEach(ch => {
                const subs = ch.suscriptores;
                if (subs < 10000) ranges['0-10K']++;
                else if (subs < 100000) ranges['10K-100K']++;
                else if (subs < 500000) ranges['100K-500K']++;
                else if (subs < 1000000) ranges['500K-1M']++;
                else ranges['1M+']++;
            });

            const ctx = document.getElementById('subscribersChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(ranges),
                    datasets: [{
                        data: Object.values(ranges),
                        backgroundColor: [
                            '#e74c3c', '#f39c12', '#2ecc71', 
                            '#3498db', '#9b59b6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function renderProvinceChart() {
            const provinceData = {};
            channelsData.forEach(ch => {
                provinceData[ch.provincia] = (provinceData[ch.provincia] || 0) + 1;
            });

            const ctx = document.getElementById('provinceChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(provinceData),
                    datasets: [{
                        label: 'Canales por Provincia',
                        data: Object.values(provinceData),
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Última actualización: ${now.toLocaleDateString('es-AR')} ${now.toLocaleTimeString('es-AR')}`;
        }

        // Función para cargar datos desde CSV (para integración con GitHub)
        async function loadDataFromGitHub() {
            try {
                // Cargar desde tu archivo CSV real
                const response = await fetch('./data/streamers_argentinos.csv');
                const csvText = await response.text();
                
                // Parsear CSV
                const lines = csvText.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                channelsData = lines.slice(1)
                    .filter(line => line.trim()) // Filtrar líneas vacías
                    .map(line => {
                        // Parsear CSV considerando comillas y comas dentro de campos
                        const values = [];
                        let current = '';
                        let inQuotes = false;
                        
                        for (let i = 0; i < line.length; i++) {
                            const char = line[i];
                            if (char === '"') {
                                inQuotes = !inQuotes;
                            } else if (char === ',' && !inQuotes) {
                                values.push(current.trim().replace(/^"|"$/g, ''));
                                current = '';
                            } else {
                                current += char;
                            }
                        }
                        values.push(current.trim().replace(/^"|"$/g, ''));
                        
                        const channel = {};
                        headers.forEach((header, index) => {
                            let value = values[index] ? values[index].trim() : '';
                            
                            // Mapear nombres de columnas de tu CSV a los que usa el dashboard
                            const fieldMap = {
                                'canal_id': 'canal_id',
                                'nombre_canal': 'nombre_canal',
                                'categoria': 'categoria',
                                'provincia': 'provincia',
                                'ciudad': 'ciudad',
                                'suscriptores': 'suscriptores',
                                'certeza': 'certeza',
                                'metodo_deteccion': 'metodo_deteccion',
                                'indicadores_argentinidad': 'indicadores_argentinidad',
                                'url': 'url',
                                'fecha_deteccion': 'fecha_deteccion',
                                'ultima_actividad': 'ultima_actividad',
                                'tiene_streaming': 'tiene_streaming',
                                'descripcion': 'descripcion',
                                'pais_detectado': 'pais_detectado',
                                'videos_analizados': 'videos_analizados'
                            };
                            
                            const mappedField = fieldMap[header] || header;
                            
                            // Convertir tipos de datos
                            if (mappedField === 'suscriptores' || mappedField === 'videos_analizados') {
                                value = parseInt(value) || 0;
                            } else if (mappedField === 'certeza') {
                                value = parseFloat(value) || 0;
                            } else if (mappedField === 'tiene_streaming') {
                                value = value.toLowerCase() === 'true' || value === '1';
                            }
                            
                            channel[mappedField] = value;
                        });
                        
                        return channel;
                    })
                    .filter(ch => ch.nombre_canal && ch.nombre_canal !== ''); // Filtrar canales sin nombre
                
                filteredData = [...channelsData];
                
                console.log(`✅ Datos cargados exitosamente: ${channelsData.length} canales argentinos`);
                console.log('📊 Muestra de datos:', channelsData[0]);
                
                // Re-inicializar con los nuevos datos
                updateStats();
                populateFilters();
                renderTable();
                updateLastUpdate();
                
            } catch (error) {
                console.error('❌ Error cargando datos desde GitHub:', error);
                console.log('📝 Usando datos de ejemplo mientras se configura la conexión...');
                
                // Datos de ejemplo que coinciden con tu estructura
                channelsData = [
                    {
                        canal_id: "UC2zO2jZCDplwm8SVsXUcxCQ",
                        nombre_canal: "La 100",
                        categoria: "Entretenimiento",
                        provincia: "Santa Fe",
                        ciudad: "Rosario",
                        suscriptores: 562000,
                        certeza: 100.0,
                        metodo_deteccion: "explicit_country",
                        indicadores_argentinidad: "menciona_argentina",
                        url: "https://youtube.com/channel/UC2zO2jZCDplwm8SVsXUcxCQ",
                        fecha_deteccion: "2025-06-18",
                        ultima_actividad: "2014-02-21",
                        tiene_streaming: true,
                        descripcion: "¡Bienvenidos al canal oficial de La100.com.ar en Youtube! Suscribite y mirá contenidos exclusivos cuando y donde quieras de El Club del Moro, No Esta Todo Dicho, Sarasa, Atardecer de un Día Agitado.",
                        pais_detectado: "Argentina",
                        videos_analizados: 5
                    },
                    {
                        canal_id: "UCFAiSCNaJnizLNIF1aSkQAQ",
                        nombre_canal: "Gran Hermano Argentina",
                        categoria: "Entretenimiento",
                        provincia: "Buenos Aires",
                        ciudad: "Buenos Aires",
                        suscriptores: 1570000,
                        certeza: 95.0,
                        metodo_deteccion: "explicit_country",
                        indicadores_argentinidad: "menciona_argentina",
                        url: "https://youtube.com/channel/UCFAiSCNaJnizLNIF1aSkQAQ",
                        fecha_deteccion: "2025-06-18",
                        ultima_actividad: "2022-07-07",
                        tiene_streaming: true,
                        descripcion: "¡Enterate de todo lo que pasa en la casa más famosa del país! 👁‍🗨 Mirá los programas acá",
                        pais_detectado: "Argentina",
                        videos_analizados: 5
                    }
                ];
                
                filteredData = [...channelsData];
                updateStats();
                populateFilters();
                renderTable();
                updateLastUpdate();
            }
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Intentar cargar datos reales desde GitHub primero
            loadDataFromGitHub();
        });
    </script>
</body>
</html>
